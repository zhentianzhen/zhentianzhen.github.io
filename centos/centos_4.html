<!DOCTYPE html>
<html>
<head>
<title>Zhentianzhen's Blog</title>
<link href="../stylesheets/bootstrap.css" type="text/css" rel="stylesheet" media="all">
<link href="../stylesheets/style.css" type="text/css" rel="stylesheet" media="all">
<!--web-font-->
<link href='http://fonts.useso.com/css?family=Playfair+Display:400,700,900,400italic,700italic,900italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.useso.com/css?family=Roboto+Condensed:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'>
<!--//web-font-->
<!-- Custom Theme files -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="Excursion Responsive web template, Bootstrap Web Templates, Flat Web Templates, Andriod Compatible web template, 
Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<!-- //Custom Theme files -->
<!-- js -->
<script src="../javascripts/jquery.min.js"></script>  
<!-- //js -->	
<!-- start-smoth-scrolling-->
<script type="text/javascript" src="../javascripts/move-top.js"></script>
<script type="text/javascript" src="../javascripts/easing.js"></script>	
<script type="text/javascript">
jQuery(document).ready(function($) {
                $(".scroll").click(function(event){		
                        event.preventDefault();
                        $('html,body').animate({scrollTop:$(this.hash).offset().top},1000);
                        });
                });
</script>
<!--//end-smoth-scrolling-->
</head>
<body>
<!--navigation-->
<div class="top-nav">
        <nav class="navbar navbar-default">
                <div class="container">
                        <div class="navbar-header">
                                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                </button>
                        </div>
                        <!-- Collect the nav links, forms, and other content for toggling -->
                        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                                <ul class="nav navbar-nav navbar-left">
                                        <li><a href="../index.html">Home</a></li>
                                        <li><a href="../php.html">Php</a></li>
                                        <li><a href="../golang.html">Golang</a></li>
                                        <li><a href="../mysql.html">MySQL</a></li>
                                        <li><a href="../mongodb.html">MongoDB</a></li>
                                        <li><a href="../redis.html">Redis</a></li>
                                        <li><a href="../git.html">Git</a></li>
                                        <li><a href="../centos.html" class="active">CentOS</a></li>
                                        <li><a href="../other.html">Other</a></li>
                                </ul>	
                                <div class="clearfix"> </div>
                        </div>
                </div>	
        </nav>		
</div>	

<!--navigation-->
<!--header-->
<div class="header">
        <div class="container">
        </div>	
</div>
<!--//header-->
<!--single-page-->
<div class="single-page">
        <div class="container">
                <div class="work-title sngl-title">
                        <ol class="breadcrumb">
                                <li><a href="../index.html">Home</a></li>
                                <li class="active">CentOS</li>
                        </ol>
                </div>
                <div class="col-md-8 single-page-left">
                        <div class="single-page-info">
                                <h5>用十条命令在一分钟内检查Linux服务器性能</h5>
                                <div style="width: 100%;">
                                        <pre style="color:#000000;background:#ffffff;">如果你的Linux服务器突然负载暴增，告警短信快发爆你的手机，如何在最短时间内找出Linux性能问题所在？来看Netflix性能工程团队的这篇博文，看它们通过十条命令在一分钟内对机器性能问题进行诊断。

概述

通过执行以下命令，可以在1分钟内对系统资源使用情况有个大致的了解。

uptime
dmesg | tail
vmstat <span style="color:#008c00; ">1</span>
mpstat <span style="color:#808030; ">-</span>P ALL <span style="color:#008c00; ">1</span>
pidstat <span style="color:#008c00; ">1</span>
iostat <span style="color:#808030; ">-</span>xz <span style="color:#008c00; ">1</span>
free <span style="color:#808030; ">-</span>m
sar <span style="color:#808030; ">-</span>n DEV <span style="color:#008c00; ">1</span>
sar <span style="color:#808030; ">-</span>n TCP<span style="color:#808030; ">,</span>ETCP <span style="color:#008c00; ">1</span>
top
其中一些命令需要安装sysstat包，有一些由procps包提供。这些命令的输出，有助于快速定位性能瓶颈，检查出所有资源（CPU、内存、磁盘IO等）的利用率（utilization）、饱和度（saturation）和错误（error）度量，也就是所谓的USE方法。

下面我们来逐一介绍下这些命令，有关这些命令更多的参数和说明，请参照命令的手册。

uptime

$ uptime
<span style="color:#008c00; ">23</span>:<span style="color:#005fd2; ">51</span>:<span style="color:#005fd2; ">26</span> up <span style="color:#008c00; ">21</span>:<span style="color:#005fd2; ">31</span><span style="color:#808030; ">,</span>  <span style="color:#008c00; ">1</span> user<span style="color:#808030; ">,</span>  load <span style="color:#005fd2; ">average</span>: <span style="color:#008000; ">30.02</span><span style="color:#808030; ">,</span> <span style="color:#008000; ">26.43</span><span style="color:#808030; ">,</span> <span style="color:#008000; ">19.02</span>
这个命令可以快速查看机器的负载情况。在Linux系统中，这些数据表示等待CPU资源的进程和阻塞在不可中断IO进程（进程状态为D）的数量。这些数据可以让我们对系统资源使用有一个宏观的了解。

命令的输出分别表示1分钟、5分钟、15分钟的平均负载情况。通过这三个数据，可以了解服务器负载是在趋于紧张还是区域缓解。如果1分钟平均负载很高，而15分钟平均负载很低，说明服务器正在命令高负载情况，需要进一步排查CPU资源都消耗在了哪里。反之，如果15分钟平均负载很高，<span style="color:#008c00; ">1</span>分钟平均负载较低，则有可能是CPU资源紧张时刻已经过去。

上面例子中的输出，可以看见最近1分钟的平均负载非常高，且远高于最近15分钟负载，因此我们需要继续排查当前系统中有什么进程消耗了大量的资源。可以通过下文将会介绍的vmstat、mpstat等命令进一步排查。

dmesg | tail

$ dmesg | tail
<span style="color:#808030; ">[</span><span style="color:#008000; ">1880957.563150</span><span style="color:#808030; ">]</span> perl invoked oom<span style="color:#808030; ">-</span><span style="color:#005fd2; ">killer</span>: gfp_mask<span style="color:#808030; ">=</span><span style="color:#008000; ">0x280da</span><span style="color:#808030; ">,</span> order<span style="color:#808030; ">=</span><span style="color:#008c00; ">0</span><span style="color:#808030; ">,</span> oom_score_adj<span style="color:#808030; ">=</span><span style="color:#008c00; ">0</span>
<span style="color:#808030; ">[</span><span style="color:#808030; ">.</span><span style="color:#808030; ">.</span><span style="color:#808030; ">.</span><span style="color:#808030; ">]</span>
<span style="color:#808030; ">[</span><span style="color:#008000; ">1880957.563400</span><span style="color:#808030; ">]</span> Out of <span style="color:#005fd2; ">memory</span>: Kill process <span style="color:#008c00; ">18694</span> <span style="color:#808030; ">(</span>perl<span style="color:#808030; ">)</span> score <span style="color:#008c00; ">246</span> <span style="color:#800000; font-weight:bold; ">or</span> sacrifice child
<span style="color:#808030; ">[</span><span style="color:#008000; ">1880957.563408</span><span style="color:#808030; ">]</span> Killed process <span style="color:#008c00; ">18694</span> <span style="color:#808030; ">(</span>perl<span style="color:#808030; ">)</span> total<span style="color:#808030; ">-</span><span style="color:#005fd2; ">vm</span>:1972392kB<span style="color:#808030; ">,</span> anon<span style="color:#808030; ">-</span><span style="color:#005fd2; ">rss</span>:1953348kB<span style="color:#808030; ">,</span> <span style="color:#400000; ">file</span><span style="color:#808030; ">-</span><span style="color:#005fd2; ">rss</span>:0kB
<span style="color:#808030; ">[</span><span style="color:#008000; ">2320864.954447</span><span style="color:#808030; ">]</span> <span style="color:#005fd2; ">TCP</span>: Possible SYN flooding on port <span style="color:#008c00; ">7001</span><span style="color:#808030; ">.</span> Dropping request<span style="color:#808030; ">.</span>  Check SNMP counters<span style="color:#808030; ">.</span>
该命令会输出系统日志的最后10行。示例中的输出，可以看见一次内核的oom kill和一次TCP丢包。这些日志可以帮助排查性能问题。千万不要忘了这一步。

vmstat <span style="color:#008c00; ">1</span>

$ vmstat <span style="color:#008c00; ">1</span>
procs <span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span>memory<span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span> <span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span>swap<span style="color:#808030; ">-</span><span style="color:#808030; ">-</span> <span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span>io<span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span> <span style="color:#808030; ">-</span>system<span style="color:#808030; ">-</span><span style="color:#808030; ">-</span> <span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span>cpu<span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span><span style="color:#808030; ">-</span>
 r  b swpd   free   buff  cache   si   so    bi    bo   <span style="color:#800000; font-weight:bold; ">in</span>   cs us sy id wa st
<span style="color:#008c00; ">34</span>  <span style="color:#008c00; ">0</span>    <span style="color:#008c00; ">0</span> <span style="color:#008c00; ">200889792</span>  <span style="color:#008c00; ">73708</span> <span style="color:#008c00; ">591828</span>    <span style="color:#008c00; ">0</span>    <span style="color:#008c00; ">0</span>     <span style="color:#008c00; ">0</span>     <span style="color:#008c00; ">5</span>    <span style="color:#008c00; ">6</span>   <span style="color:#008c00; ">10</span> <span style="color:#008c00; ">96</span>  <span style="color:#008c00; ">1</span>  <span style="color:#008c00; ">3</span>  <span style="color:#008c00; ">0</span>  <span style="color:#008c00; ">0</span>
<span style="color:#008c00; ">32</span>  <span style="color:#008c00; ">0</span>    <span style="color:#008c00; ">0</span> <span style="color:#008c00; ">200889920</span>  <span style="color:#008c00; ">73708</span> <span style="color:#008c00; ">591860</span>    <span style="color:#008c00; ">0</span>    <span style="color:#008c00; ">0</span>     <span style="color:#008c00; ">0</span>   <span style="color:#008c00; ">592</span> <span style="color:#008c00; ">13284</span> <span style="color:#008c00; ">4282</span> <span style="color:#008c00; ">98</span>  <span style="color:#008c00; ">1</span>  <span style="color:#008c00; ">1</span>  <span style="color:#008c00; ">0</span>  <span style="color:#008c00; ">0</span>
<span style="color:#008c00; ">32</span>  <span style="color:#008c00; ">0</span>    <span style="color:#008c00; ">0</span> <span style="color:#008c00; ">200890112</span>  <span style="color:#008c00; ">73708</span> <span style="color:#008c00; ">591860</span>    <span style="color:#008c00; ">0</span>    <span style="color:#008c00; ">0</span>     <span style="color:#008c00; ">0</span>     <span style="color:#008c00; ">0</span> <span style="color:#008c00; ">9501</span> <span style="color:#008c00; ">2154</span> <span style="color:#008c00; ">99</span>  <span style="color:#008c00; ">1</span>  <span style="color:#008c00; ">0</span>  <span style="color:#008c00; ">0</span>  <span style="color:#008c00; ">0</span>
<span style="color:#008c00; ">32</span>  <span style="color:#008c00; ">0</span>    <span style="color:#008c00; ">0</span> <span style="color:#008c00; ">200889568</span>  <span style="color:#008c00; ">73712</span> <span style="color:#008c00; ">591856</span>    <span style="color:#008c00; ">0</span>    <span style="color:#008c00; ">0</span>     <span style="color:#008c00; ">0</span>    <span style="color:#008c00; ">48</span> <span style="color:#008c00; ">11900</span> <span style="color:#008c00; ">2459</span> <span style="color:#008c00; ">99</span>  <span style="color:#008c00; ">0</span>  <span style="color:#008c00; ">0</span>  <span style="color:#008c00; ">0</span>  <span style="color:#008c00; ">0</span>
<span style="color:#008c00; ">32</span>  <span style="color:#008c00; ">0</span>    <span style="color:#008c00; ">0</span> <span style="color:#008c00; ">200890208</span>  <span style="color:#008c00; ">73712</span> <span style="color:#008c00; ">591860</span>    <span style="color:#008c00; ">0</span>    <span style="color:#008c00; ">0</span>     <span style="color:#008c00; ">0</span>     <span style="color:#008c00; ">0</span> <span style="color:#008c00; ">15898</span> <span style="color:#008c00; ">4840</span> <span style="color:#008c00; ">98</span>  <span style="color:#008c00; ">1</span>  <span style="color:#008c00; ">1</span>  <span style="color:#008c00; ">0</span>  <span style="color:#008c00; ">0</span>
^C
vmstat<span style="color:#808030; ">(</span><span style="color:#008c00; ">8</span><span style="color:#808030; ">)</span> 命令，每行会输出一些系统核心指标，这些指标可以让我们更详细的了解系统状态。后面跟的参数1，表示每秒输出一次统计信息，表头提示了每一列的含义，这几介绍一些和性能调优相关的列：

r：等待在CPU资源的进程数。这个数据比平均负载更加能够体现CPU负载情况，数据中不包含等待IO的进程。如果这个数值大于机器CPU核数，那么机器的CPU资源已经饱和。
free：系统可用内存数（以千字节为单位），如果剩余内存不足，也会导致系统性能问题。下文介绍到的free命令，可以更详细的了解系统内存的使用情况。
si<span style="color:#808030; ">,</span> so：交换区写入和读取的数量。如果这个数据不为0，说明系统已经在使用交换区（swap），机器物理内存已经不足。
us<span style="color:#808030; ">,</span> sy<span style="color:#808030; ">,</span> id<span style="color:#808030; ">,</span> wa<span style="color:#808030; ">,</span> st：这些都代表了CPU时间的消耗，它们分别表示用户时间（user）、系统（内核）时间（sys）、空闲时间（idle）、IO等待时间（wait）和被偷走的时间（stolen，一般被其他虚拟机消耗）。
上述这些CPU时间，可以让我们很快了解CPU是否出于繁忙状态。一般情况下，如果用户时间和系统时间相加非常大，CPU出于忙于执行指令。如果IO等待时间很长，那么系统的瓶颈可能在磁盘IO。

示例命令的输出可以看见，大量CPU时间消耗在用户态，也就是用户应用程序消耗了CPU时间。这不一定是性能问题，需要结合r队列，一起分析。

mpstat <span style="color:#808030; ">-</span>P ALL <span style="color:#008c00; ">1</span>

$ mpstat <span style="color:#808030; ">-</span>P ALL <span style="color:#008c00; ">1</span>
Linux <span style="color:#008000; ">3.13</span><span style="color:#808030; ">.</span><span style="color:#008c00; ">0</span><span style="color:#808030; ">-</span><span style="color:#008c00; ">49</span><span style="color:#808030; ">-</span>generic <span style="color:#808030; ">(</span>titanclusters<span style="color:#808030; ">-</span>xxxxx<span style="color:#808030; ">)</span>  <span style="color:#008c00; ">07</span><span style="color:#808030; ">/</span><span style="color:#008c00; ">14</span><span style="color:#808030; ">/</span><span style="color:#008c00; ">2015</span>  _x86_64_ <span style="color:#808030; ">(</span><span style="color:#008c00; ">32</span> CPU<span style="color:#808030; ">)</span>
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">38</span>:<span style="color:#005fd2; ">49</span> PM  CPU   %usr  %nice   %sys %iowait   %irq  %soft  %steal  %guest  %gnice  %idle
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">38</span>:<span style="color:#005fd2; ">50</span> PM  all  <span style="color:#008000; ">98.47</span>   <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">0.75</span>    <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">0.78</span>
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">38</span>:<span style="color:#005fd2; ">50</span> PM    <span style="color:#008c00; ">0</span>  <span style="color:#008000; ">96.04</span>   <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">2.97</span>    <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">0.99</span>
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">38</span>:<span style="color:#005fd2; ">50</span> PM    <span style="color:#008c00; ">1</span>  <span style="color:#008000; ">97.00</span>   <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">1.00</span>    <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">2.00</span>
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">38</span>:<span style="color:#005fd2; ">50</span> PM    <span style="color:#008c00; ">2</span>  <span style="color:#008000; ">98.00</span>   <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">1.00</span>    <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">1.00</span>
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">38</span>:<span style="color:#005fd2; ">50</span> PM    <span style="color:#008c00; ">3</span>  <span style="color:#008000; ">96.97</span>   <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">3.03</span>
<span style="color:#808030; ">[</span><span style="color:#808030; ">.</span><span style="color:#808030; ">.</span><span style="color:#808030; ">.</span><span style="color:#808030; ">]</span>
该命令可以显示每个CPU的占用情况，如果有一个CPU占用率特别高，那么有可能是一个单线程应用程序引起的。

pidstat <span style="color:#008c00; ">1</span>

$ pidstat <span style="color:#008c00; ">1</span>
Linux <span style="color:#008000; ">3.13</span><span style="color:#808030; ">.</span><span style="color:#008c00; ">0</span><span style="color:#808030; ">-</span><span style="color:#008c00; ">49</span><span style="color:#808030; ">-</span>generic <span style="color:#808030; ">(</span>titanclusters<span style="color:#808030; ">-</span>xxxxx<span style="color:#808030; ">)</span>  <span style="color:#008c00; ">07</span><span style="color:#808030; ">/</span><span style="color:#008c00; ">14</span><span style="color:#808030; ">/</span><span style="color:#008c00; ">2015</span>    _x86_64_    <span style="color:#808030; ">(</span><span style="color:#008c00; ">32</span> CPU<span style="color:#808030; ">)</span>
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">41</span>:<span style="color:#005fd2; ">02</span> PM   UID       PID    %usr %system  %guest    %CPU   CPU  Command
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">41</span>:<span style="color:#005fd2; ">03</span> PM     <span style="color:#008c00; ">0</span>         <span style="color:#008c00; ">9</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.94</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.94</span>     <span style="color:#008c00; ">1</span>  rcuos<span style="color:#808030; ">/</span><span style="color:#008c00; ">0</span>
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">41</span>:<span style="color:#005fd2; ">03</span> PM     <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">4214</span>    <span style="color:#008000; ">5.66</span>    <span style="color:#008000; ">5.66</span>    <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">11.32</span>    <span style="color:#008c00; ">15</span>  mesos<span style="color:#808030; ">-</span>slave
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">41</span>:<span style="color:#005fd2; ">03</span> PM     <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">4354</span>    <span style="color:#008000; ">0.94</span>    <span style="color:#008000; ">0.94</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">1.89</span>     <span style="color:#008c00; ">8</span>  java
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">41</span>:<span style="color:#005fd2; ">03</span> PM     <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">6521</span> <span style="color:#008000; ">1596.23</span>    <span style="color:#008000; ">1.89</span>    <span style="color:#008000; ">0.00</span> <span style="color:#008000; ">1598.11</span>    <span style="color:#008c00; ">27</span>  java
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">41</span>:<span style="color:#005fd2; ">03</span> PM     <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">6564</span> <span style="color:#008000; ">1571.70</span>    <span style="color:#008000; ">7.55</span>    <span style="color:#008000; ">0.00</span> <span style="color:#008000; ">1579.25</span>    <span style="color:#008c00; ">28</span>  java
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">41</span>:<span style="color:#005fd2; ">03</span> PM <span style="color:#008c00; ">60004</span>     <span style="color:#008c00; ">60154</span>    <span style="color:#008000; ">0.94</span>    <span style="color:#008000; ">4.72</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">5.66</span>     <span style="color:#008c00; ">9</span>  pidstat
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">41</span>:<span style="color:#005fd2; ">03</span> PM   UID       PID    %usr %system  %guest    %CPU   CPU  Command
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">41</span>:<span style="color:#005fd2; ">04</span> PM     <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">4214</span>    <span style="color:#008000; ">6.00</span>    <span style="color:#008000; ">2.00</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">8.00</span>    <span style="color:#008c00; ">15</span>  mesos<span style="color:#808030; ">-</span>slave
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">41</span>:<span style="color:#005fd2; ">04</span> PM     <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">6521</span> <span style="color:#008000; ">1590.00</span>    <span style="color:#008000; ">1.00</span>    <span style="color:#008000; ">0.00</span> <span style="color:#008000; ">1591.00</span>    <span style="color:#008c00; ">27</span>  java
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">41</span>:<span style="color:#005fd2; ">04</span> PM     <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">6564</span> <span style="color:#008000; ">1573.00</span>   <span style="color:#008000; ">10.00</span>    <span style="color:#008000; ">0.00</span> <span style="color:#008000; ">1583.00</span>    <span style="color:#008c00; ">28</span>  java
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">41</span>:<span style="color:#005fd2; ">04</span> PM   <span style="color:#008c00; ">108</span>      <span style="color:#008c00; ">6718</span>    <span style="color:#008000; ">1.00</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">1.00</span>     <span style="color:#008c00; ">0</span>  snmp<span style="color:#808030; ">-</span><span style="color:#400000; ">pass</span>
<span style="color:#008c00; ">07</span>:<span style="color:#005fd2; ">41</span>:<span style="color:#005fd2; ">04</span> PM <span style="color:#008c00; ">60004</span>     <span style="color:#008c00; ">60154</span>    <span style="color:#008000; ">1.00</span>    <span style="color:#008000; ">4.00</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">5.00</span>     <span style="color:#008c00; ">9</span>  pidstat
^C
pidstat命令输出进程的CPU占用率，该命令会持续输出，并且不会覆盖之前的数据，可以方便观察系统动态。如上的输出，可以看见两个JAVA进程占用了将近1600%的CPU时间，既消耗了大约16个CPU核心的运算资源。

iostat <span style="color:#808030; ">-</span>xz <span style="color:#008c00; ">1</span>

$ iostat <span style="color:#808030; ">-</span>xz <span style="color:#008c00; ">1</span>
Linux <span style="color:#008000; ">3.13</span><span style="color:#808030; ">.</span><span style="color:#008c00; ">0</span><span style="color:#808030; ">-</span><span style="color:#008c00; ">49</span><span style="color:#808030; ">-</span>generic <span style="color:#808030; ">(</span>titanclusters<span style="color:#808030; ">-</span>xxxxx<span style="color:#808030; ">)</span>  <span style="color:#008c00; ">07</span><span style="color:#808030; ">/</span><span style="color:#008c00; ">14</span><span style="color:#808030; ">/</span><span style="color:#008c00; ">2015</span>  _x86_64_ <span style="color:#808030; ">(</span><span style="color:#008c00; ">32</span> CPU<span style="color:#808030; ">)</span>
avg<span style="color:#808030; ">-</span><span style="color:#005fd2; ">cpu</span>:  %user   %nice %system %iowait  %steal   %idle
          <span style="color:#008000; ">73.96</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">3.73</span>    <span style="color:#008000; ">0.03</span>    <span style="color:#008000; ">0.06</span>   <span style="color:#008000; ">22.21</span>
<span style="color:#005fd2; ">Device</span>:   rrqm<span style="color:#808030; ">/</span>s   wrqm<span style="color:#808030; ">/</span>s     r<span style="color:#808030; ">/</span>s     w<span style="color:#808030; ">/</span>s    rkB<span style="color:#808030; ">/</span>s    wkB<span style="color:#808030; ">/</span>s avgrq<span style="color:#808030; ">-</span>sz avgqu<span style="color:#808030; ">-</span>sz   await r_await w_await  svctm  %util
xvda        <span style="color:#008000; ">0.00</span>     <span style="color:#008000; ">0.23</span>    <span style="color:#008000; ">0.21</span>    <span style="color:#008000; ">0.18</span>     <span style="color:#008000; ">4.52</span>     <span style="color:#008000; ">2.08</span>    <span style="color:#008000; ">34.37</span>     <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">9.98</span>   <span style="color:#008000; ">13.80</span>    <span style="color:#008000; ">5.42</span>   <span style="color:#008000; ">2.44</span>   <span style="color:#008000; ">0.09</span>
xvdb        <span style="color:#008000; ">0.01</span>     <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">1.02</span>    <span style="color:#008000; ">8.94</span>   <span style="color:#008000; ">127.97</span>   <span style="color:#008000; ">598.53</span>   <span style="color:#008000; ">145.79</span>     <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.43</span>    <span style="color:#008000; ">1.78</span>    <span style="color:#008000; ">0.28</span>   <span style="color:#008000; ">0.25</span>   <span style="color:#008000; ">0.25</span>
xvdc        <span style="color:#008000; ">0.01</span>     <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">1.02</span>    <span style="color:#008000; ">8.86</span>   <span style="color:#008000; ">127.79</span>   <span style="color:#008000; ">595.94</span>   <span style="color:#008000; ">146.50</span>     <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.45</span>    <span style="color:#008000; ">1.82</span>    <span style="color:#008000; ">0.30</span>   <span style="color:#008000; ">0.27</span>   <span style="color:#008000; ">0.26</span>
dm<span style="color:#808030; ">-</span><span style="color:#008c00; ">0</span>        <span style="color:#008000; ">0.00</span>     <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.69</span>    <span style="color:#008000; ">2.32</span>    <span style="color:#008000; ">10.47</span>    <span style="color:#008000; ">31.69</span>    <span style="color:#008000; ">28.01</span>     <span style="color:#008000; ">0.01</span>    <span style="color:#008000; ">3.23</span>    <span style="color:#008000; ">0.71</span>    <span style="color:#008000; ">3.98</span>   <span style="color:#008000; ">0.13</span>   <span style="color:#008000; ">0.04</span>
dm<span style="color:#808030; ">-</span><span style="color:#008c00; ">1</span>        <span style="color:#008000; ">0.00</span>     <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.94</span>     <span style="color:#008000; ">0.01</span>     <span style="color:#008000; ">3.78</span>     <span style="color:#008000; ">8.00</span>     <span style="color:#008000; ">0.33</span>  <span style="color:#008000; ">345.84</span>    <span style="color:#008000; ">0.04</span>  <span style="color:#008000; ">346.81</span>   <span style="color:#008000; ">0.01</span>   <span style="color:#008000; ">0.00</span>
dm<span style="color:#808030; ">-</span><span style="color:#008c00; ">2</span>        <span style="color:#008000; ">0.00</span>     <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">0.09</span>    <span style="color:#008000; ">0.07</span>     <span style="color:#008000; ">1.35</span>     <span style="color:#008000; ">0.36</span>    <span style="color:#008000; ">22.50</span>     <span style="color:#008000; ">0.00</span>    <span style="color:#008000; ">2.55</span>    <span style="color:#008000; ">0.23</span>    <span style="color:#008000; ">5.62</span>   <span style="color:#008000; ">1.78</span>   <span style="color:#008000; ">0.03</span>
<span style="color:#808030; ">[</span><span style="color:#808030; ">.</span><span style="color:#808030; ">.</span><span style="color:#808030; ">.</span><span style="color:#808030; ">]</span>
^C
iostat命令主要用于查看机器磁盘IO情况。该命令输出的列，主要含义是：

r<span style="color:#808030; ">/</span>s<span style="color:#808030; ">,</span> w<span style="color:#808030; ">/</span>s<span style="color:#808030; ">,</span> rkB<span style="color:#808030; ">/</span>s<span style="color:#808030; ">,</span> wkB<span style="color:#808030; ">/</span>s：分别表示每秒读写次数和每秒读写数据量（千字节）。读写量过大，可能会引起性能问题。
await：IO操作的平均等待时间，单位是毫秒。这是应用程序在和磁盘交互时，需要消耗的时间，包括IO等待和实际操作的耗时。如果这个数值过大，可能是硬件设备遇到了瓶颈或者出现故障。
avgqu<span style="color:#808030; ">-</span>sz：向设备发出的请求平均数量。如果这个数值大于1，可能是硬件设备已经饱和（部分前端硬件设备支持并行写入）。
%util：设备利用率。这个数值表示设备的繁忙程度，经验值是如果超过60，可能会影响IO性能（可以参照IO操作平均等待时间）。如果到达100%，说明硬件设备已经饱和。
如果显示的是逻辑设备的数据，那么设备利用率不代表后端实际的硬件设备已经饱和。值得注意的是，即使IO性能不理想，也不一定意味这应用程序性能会不好，可以利用诸如预读取、写缓存等策略提升应用性能。

free –m

$ free <span style="color:#808030; ">-</span>m
             total       used       free     shared    buffers     cached
<span style="color:#005fd2; ">Mem</span>:        <span style="color:#008c00; ">245998</span>      <span style="color:#008c00; ">24545</span>     <span style="color:#008c00; ">221453</span>         <span style="color:#008c00; ">83</span>         <span style="color:#008c00; ">59</span>        <span style="color:#008c00; ">541</span>
<span style="color:#808030; ">-</span><span style="color:#808030; ">/</span><span style="color:#808030; ">+</span> buffers<span style="color:#808030; ">/</span><span style="color:#005fd2; ">cache</span>:      <span style="color:#008c00; ">23944</span>     <span style="color:#008c00; ">222053</span>
<span style="color:#005fd2; ">Swap</span>:            <span style="color:#008c00; ">0</span>          <span style="color:#008c00; ">0</span>          <span style="color:#008c00; ">0</span>
free命令可以查看系统内存的使用情况，<span style="color:#808030; ">-</span>m参数表示按照兆字节展示。最后两列分别表示用于IO缓存的内存数，和用于文件系统页缓存的内存数。需要注意的是，第二行<span style="color:#808030; ">-</span><span style="color:#808030; ">/</span><span style="color:#808030; ">+</span> buffers<span style="color:#808030; ">/</span>cache，看上去缓存占用了大量内存空间。这是Linux系统的内存使用策略，尽可能的利用内存，如果应用程序需要内存，这部分内存会立即被回收并分配给应用程序。因此，这部分内存一般也被当成是可用内存。

如果可用内存非常少，系统可能会动用交换区（如果配置了的话），这样会增加IO开销（可以在iostat命令中提现），降低系统性能。

sar <span style="color:#808030; ">-</span>n DEV <span style="color:#008c00; ">1</span>

$ sar <span style="color:#808030; ">-</span>n DEV <span style="color:#008c00; ">1</span>
Linux <span style="color:#008000; ">3.13</span><span style="color:#808030; ">.</span><span style="color:#008c00; ">0</span><span style="color:#808030; ">-</span><span style="color:#008c00; ">49</span><span style="color:#808030; ">-</span>generic <span style="color:#808030; ">(</span>titanclusters<span style="color:#808030; ">-</span>xxxxx<span style="color:#808030; ">)</span>  <span style="color:#008c00; ">07</span><span style="color:#808030; ">/</span><span style="color:#008c00; ">14</span><span style="color:#808030; ">/</span><span style="color:#008c00; ">2015</span>     _x86_64_    <span style="color:#808030; ">(</span><span style="color:#008c00; ">32</span> CPU<span style="color:#808030; ">)</span>
<span style="color:#008c00; ">12</span>:<span style="color:#005fd2; ">16</span>:<span style="color:#005fd2; ">48</span> AM     IFACE   rxpck<span style="color:#808030; ">/</span>s   txpck<span style="color:#808030; ">/</span>s    rxkB<span style="color:#808030; ">/</span>s    txkB<span style="color:#808030; ">/</span>s   rxcmp<span style="color:#808030; ">/</span>s   txcmp<span style="color:#808030; ">/</span>s  rxmcst<span style="color:#808030; ">/</span>s   %ifutil
<span style="color:#008c00; ">12</span>:<span style="color:#005fd2; ">16</span>:<span style="color:#005fd2; ">49</span> AM      eth0  <span style="color:#008000; ">18763.00</span>   <span style="color:#008000; ">5032.00</span>  <span style="color:#008000; ">20686.42</span>    <span style="color:#008000; ">478.30</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>
<span style="color:#008c00; ">12</span>:<span style="color:#005fd2; ">16</span>:<span style="color:#005fd2; ">49</span> AM        lo     <span style="color:#008000; ">14.00</span>     <span style="color:#008000; ">14.00</span>      <span style="color:#008000; ">1.36</span>      <span style="color:#008000; ">1.36</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>
<span style="color:#008c00; ">12</span>:<span style="color:#005fd2; ">16</span>:<span style="color:#005fd2; ">49</span> AM   docker0      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>
<span style="color:#008c00; ">12</span>:<span style="color:#005fd2; ">16</span>:<span style="color:#005fd2; ">49</span> AM     IFACE   rxpck<span style="color:#808030; ">/</span>s   txpck<span style="color:#808030; ">/</span>s    rxkB<span style="color:#808030; ">/</span>s    txkB<span style="color:#808030; ">/</span>s   rxcmp<span style="color:#808030; ">/</span>s   txcmp<span style="color:#808030; ">/</span>s  rxmcst<span style="color:#808030; ">/</span>s   %ifutil
<span style="color:#008c00; ">12</span>:<span style="color:#005fd2; ">16</span>:<span style="color:#005fd2; ">50</span> AM      eth0  <span style="color:#008000; ">19763.00</span>   <span style="color:#008000; ">5101.00</span>  <span style="color:#008000; ">21999.10</span>    <span style="color:#008000; ">482.56</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>
<span style="color:#008c00; ">12</span>:<span style="color:#005fd2; ">16</span>:<span style="color:#005fd2; ">50</span> AM        lo     <span style="color:#008000; ">20.00</span>     <span style="color:#008000; ">20.00</span>      <span style="color:#008000; ">3.25</span>      <span style="color:#008000; ">3.25</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>
<span style="color:#008c00; ">12</span>:<span style="color:#005fd2; ">16</span>:<span style="color:#005fd2; ">50</span> AM   docker0      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>
^C
sar命令在这里可以查看网络设备的吞吐率。在排查性能问题时，可以通过网络设备的吞吐量，判断网络设备是否已经饱和。如示例输出中，eth0网卡设备，吞吐率大概在22 Mbytes<span style="color:#808030; ">/</span>s，既176 Mbits<span style="color:#808030; ">/</span>sec，没有达到1Gbit<span style="color:#808030; ">/</span>sec的硬件上限。

sar <span style="color:#808030; ">-</span>n TCP<span style="color:#808030; ">,</span>ETCP <span style="color:#008c00; ">1</span>

$ sar <span style="color:#808030; ">-</span>n TCP<span style="color:#808030; ">,</span>ETCP <span style="color:#008c00; ">1</span>
Linux <span style="color:#008000; ">3.13</span><span style="color:#808030; ">.</span><span style="color:#008c00; ">0</span><span style="color:#808030; ">-</span><span style="color:#008c00; ">49</span><span style="color:#808030; ">-</span>generic <span style="color:#808030; ">(</span>titanclusters<span style="color:#808030; ">-</span>xxxxx<span style="color:#808030; ">)</span>  <span style="color:#008c00; ">07</span><span style="color:#808030; ">/</span><span style="color:#008c00; ">14</span><span style="color:#808030; ">/</span><span style="color:#008c00; ">2015</span>    _x86_64_    <span style="color:#808030; ">(</span><span style="color:#008c00; ">32</span> CPU<span style="color:#808030; ">)</span>
<span style="color:#008c00; ">12</span>:<span style="color:#005fd2; ">17</span>:<span style="color:#005fd2; ">19</span> AM  active<span style="color:#808030; ">/</span>s passive<span style="color:#808030; ">/</span>s    iseg<span style="color:#808030; ">/</span>s    oseg<span style="color:#808030; ">/</span>s
<span style="color:#008c00; ">12</span>:<span style="color:#005fd2; ">17</span>:<span style="color:#005fd2; ">20</span> AM      <span style="color:#008000; ">1.00</span>      <span style="color:#008000; ">0.00</span>  <span style="color:#008000; ">10233.00</span>  <span style="color:#008000; ">18846.00</span>
<span style="color:#008c00; ">12</span>:<span style="color:#005fd2; ">17</span>:<span style="color:#005fd2; ">19</span> AM  atmptf<span style="color:#808030; ">/</span>s  estres<span style="color:#808030; ">/</span>s retrans<span style="color:#808030; ">/</span>s isegerr<span style="color:#808030; ">/</span>s   orsts<span style="color:#808030; ">/</span>s
<span style="color:#008c00; ">12</span>:<span style="color:#005fd2; ">17</span>:<span style="color:#005fd2; ">20</span> AM      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>
<span style="color:#008c00; ">12</span>:<span style="color:#005fd2; ">17</span>:<span style="color:#005fd2; ">20</span> AM  active<span style="color:#808030; ">/</span>s passive<span style="color:#808030; ">/</span>s    iseg<span style="color:#808030; ">/</span>s    oseg<span style="color:#808030; ">/</span>s
<span style="color:#008c00; ">12</span>:<span style="color:#005fd2; ">17</span>:<span style="color:#005fd2; ">21</span> AM      <span style="color:#008000; ">1.00</span>      <span style="color:#008000; ">0.00</span>   <span style="color:#008000; ">8359.00</span>   <span style="color:#008000; ">6039.00</span>
<span style="color:#008c00; ">12</span>:<span style="color:#005fd2; ">17</span>:<span style="color:#005fd2; ">20</span> AM  atmptf<span style="color:#808030; ">/</span>s  estres<span style="color:#808030; ">/</span>s retrans<span style="color:#808030; ">/</span>s isegerr<span style="color:#808030; ">/</span>s   orsts<span style="color:#808030; ">/</span>s
<span style="color:#008c00; ">12</span>:<span style="color:#005fd2; ">17</span>:<span style="color:#005fd2; ">21</span> AM      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>      <span style="color:#008000; ">0.00</span>
^C
sar命令在这里用于查看TCP连接状态，其中包括：

active<span style="color:#808030; ">/</span>s：每秒本地发起的TCP连接数，既通过connect调用创建的TCP连接；
passive<span style="color:#808030; ">/</span>s：每秒远程发起的TCP连接数，即通过accept调用创建的TCP连接；
retrans<span style="color:#808030; ">/</span>s：每秒TCP重传数量；
TCP连接数可以用来判断性能问题是否由于建立了过多的连接，进一步可以判断是主动发起的连接，还是被动接受的连接。TCP重传可能是因为网络环境恶劣，或者服务器压力过大导致丢包。

top

$ top
top <span style="color:#808030; ">-</span> <span style="color:#008c00; ">00</span>:<span style="color:#005fd2; ">15</span>:<span style="color:#005fd2; ">40</span> up <span style="color:#008c00; ">21</span>:<span style="color:#005fd2; ">56</span><span style="color:#808030; ">,</span>  <span style="color:#008c00; ">1</span> user<span style="color:#808030; ">,</span>  load <span style="color:#005fd2; ">average</span>: <span style="color:#008000; ">31.09</span><span style="color:#808030; ">,</span> <span style="color:#008000; ">29.87</span><span style="color:#808030; ">,</span> <span style="color:#008000; ">29.92</span>
<span style="color:#005fd2; ">Tasks</span>: <span style="color:#008c00; ">871</span> total<span style="color:#808030; ">,</span>   <span style="color:#008c00; ">1</span> running<span style="color:#808030; ">,</span> <span style="color:#008c00; ">868</span> sleeping<span style="color:#808030; ">,</span>   <span style="color:#008c00; ">0</span> stopped<span style="color:#808030; ">,</span>   <span style="color:#008c00; ">2</span> zombie
%Cpu<span style="color:#808030; ">(</span>s<span style="color:#808030; ">)</span>: <span style="color:#008000; ">96.8</span> us<span style="color:#808030; ">,</span>  <span style="color:#008000; ">0.4</span> sy<span style="color:#808030; ">,</span>  <span style="color:#008000; ">0.0</span> ni<span style="color:#808030; ">,</span>  <span style="color:#008000; ">2.7</span> id<span style="color:#808030; ">,</span>  <span style="color:#008000; ">0.1</span> wa<span style="color:#808030; ">,</span>  <span style="color:#008000; ">0.0</span> hi<span style="color:#808030; ">,</span>  <span style="color:#008000; ">0.0</span> si<span style="color:#808030; ">,</span>  <span style="color:#008000; ">0.0</span> st
KiB <span style="color:#005fd2; ">Mem</span>:  <span style="color:#008c00; ">25190241</span><span style="color:#808030; ">+</span>total<span style="color:#808030; ">,</span> <span style="color:#008c00; ">24921688</span> used<span style="color:#808030; ">,</span> <span style="color:#008c00; ">22698073</span><span style="color:#808030; ">+</span>free<span style="color:#808030; ">,</span>    <span style="color:#008c00; ">60448</span> buffers
KiB <span style="color:#005fd2; ">Swap</span>:        <span style="color:#008c00; ">0</span> total<span style="color:#808030; ">,</span>        <span style="color:#008c00; ">0</span> used<span style="color:#808030; ">,</span>        <span style="color:#008c00; ">0</span> free<span style="color:#808030; ">.</span>   <span style="color:#008c00; ">554208</span> cached Mem
   PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME<span style="color:#808030; ">+</span> COMMAND
 <span style="color:#008c00; ">20248</span> root      <span style="color:#008c00; ">20</span>   <span style="color:#008c00; ">0</span>  <span style="color:#008000; ">0.</span>227t <span style="color:#008000; ">0.</span>012t  <span style="color:#008c00; ">18748</span> S  <span style="color:#008c00; ">3090</span>  <span style="color:#008000; ">5.2</span>  <span style="color:#008c00; ">29812</span>:<span style="color:#005fd2; ">58</span> java
  <span style="color:#008c00; ">4213</span> root      <span style="color:#008c00; ">20</span>   <span style="color:#008c00; ">0</span> <span style="color:#008c00; ">2722544</span>  <span style="color:#008c00; ">64640</span>  <span style="color:#008c00; ">44232</span> S  <span style="color:#008000; ">23.5</span>  <span style="color:#008000; ">0.0</span> <span style="color:#008c00; ">233</span>:<span style="color:#005fd2; ">35</span><span style="color:#808030; ">.</span><span style="color:#008c00; ">37</span> mesos<span style="color:#808030; ">-</span>slave
 <span style="color:#008c00; ">66128</span> titancl<span style="color:#808030; ">+</span>  <span style="color:#008c00; ">20</span>   <span style="color:#008c00; ">0</span>   <span style="color:#008c00; ">24344</span>   <span style="color:#008c00; ">2332</span>   <span style="color:#008c00; ">1172</span> R   <span style="color:#008000; ">1.0</span>  <span style="color:#008000; ">0.0</span>   <span style="color:#008c00; ">0</span>:<span style="color:#005fd2; ">00</span><span style="color:#808030; ">.</span><span style="color:#008c00; ">07</span> top
  <span style="color:#008c00; ">5235</span> root      <span style="color:#008c00; ">20</span>   <span style="color:#008c00; ">0</span> <span style="color:#008000; ">38.</span>227g <span style="color:#008c00; ">547004</span>  <span style="color:#008c00; ">49996</span> S   <span style="color:#008000; ">0.7</span>  <span style="color:#008000; ">0.2</span>   <span style="color:#008c00; ">2</span>:<span style="color:#005fd2; ">02</span><span style="color:#808030; ">.</span><span style="color:#008c00; ">74</span> java
  <span style="color:#008c00; ">4299</span> root      <span style="color:#008c00; ">20</span>   <span style="color:#008c00; ">0</span> <span style="color:#008000; ">20.</span>015g <span style="color:#008000; ">2.</span>682g  <span style="color:#008c00; ">16836</span> S   <span style="color:#008000; ">0.3</span>  <span style="color:#008000; ">1.1</span>  <span style="color:#008c00; ">33</span>:<span style="color:#005fd2; ">14</span><span style="color:#808030; ">.</span><span style="color:#008c00; ">42</span> java
     <span style="color:#008c00; ">1</span> root      <span style="color:#008c00; ">20</span>   <span style="color:#008c00; ">0</span>   <span style="color:#008c00; ">33620</span>   <span style="color:#008c00; ">2920</span>   <span style="color:#008c00; ">1496</span> S   <span style="color:#008000; ">0.0</span>  <span style="color:#008000; ">0.0</span>   <span style="color:#008c00; ">0</span>:<span style="color:#005fd2; ">03</span><span style="color:#808030; ">.</span><span style="color:#008c00; ">82</span> init
     <span style="color:#008c00; ">2</span> root      <span style="color:#008c00; ">20</span>   <span style="color:#008c00; ">0</span>       <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">0</span> S   <span style="color:#008000; ">0.0</span>  <span style="color:#008000; ">0.0</span>   <span style="color:#008c00; ">0</span>:<span style="color:#005fd2; ">00</span><span style="color:#808030; ">.</span><span style="color:#008c00; ">02</span> kthreadd
     <span style="color:#008c00; ">3</span> root      <span style="color:#008c00; ">20</span>   <span style="color:#008c00; ">0</span>       <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">0</span> S   <span style="color:#008000; ">0.0</span>  <span style="color:#008000; ">0.0</span>   <span style="color:#008c00; ">0</span>:<span style="color:#005fd2; ">05</span><span style="color:#808030; ">.</span><span style="color:#008c00; ">35</span> ksoftirqd<span style="color:#808030; ">/</span><span style="color:#008c00; ">0</span>
     <span style="color:#008c00; ">5</span> root       <span style="color:#008c00; ">0</span> <span style="color:#808030; ">-</span><span style="color:#008c00; ">20</span>       <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">0</span> S   <span style="color:#008000; ">0.0</span>  <span style="color:#008000; ">0.0</span>   <span style="color:#008c00; ">0</span>:<span style="color:#005fd2; ">00</span><span style="color:#808030; ">.</span><span style="color:#008c00; ">00</span> kworker<span style="color:#808030; ">/</span><span style="color:#008c00; ">0</span>:<span style="color:#005fd2; ">0H</span>
     <span style="color:#008c00; ">6</span> root      <span style="color:#008c00; ">20</span>   <span style="color:#008c00; ">0</span>       <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">0</span> S   <span style="color:#008000; ">0.0</span>  <span style="color:#008000; ">0.0</span>   <span style="color:#008c00; ">0</span>:<span style="color:#005fd2; ">06</span><span style="color:#808030; ">.</span><span style="color:#008c00; ">94</span> kworker<span style="color:#808030; ">/</span><span style="color:#005fd2; ">u256</span>:<span style="color:#008c00; ">0</span>
     <span style="color:#008c00; ">8</span> root      <span style="color:#008c00; ">20</span>   <span style="color:#008c00; ">0</span>       <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">0</span>      <span style="color:#008c00; ">0</span> S   <span style="color:#008000; ">0.0</span>  <span style="color:#008000; ">0.0</span>   <span style="color:#008c00; ">2</span>:<span style="color:#005fd2; ">38</span><span style="color:#808030; ">.</span><span style="color:#008c00; ">05</span> rcu_sched
top命令包含了前面好几个命令的检查的内容。比如系统负载情况（uptime）、系统内存使用情况（free）、系统CPU使用情况（vmstat）等。因此通过这个命令，可以相对全面的查看系统负载的来源。同时，top命令支持排序，可以按照不同的列排序，方便查找出诸如内存占用最多的进程、CPU占用率最高的进程等。

但是，top命令相对于前面一些命令，输出是一个瞬间值，如果不持续盯着，可能会错过一些线索。这时可能需要暂停top命令刷新，来记录和比对数据。

总结

排查Linux服务器性能问题还有很多工具，上面介绍的一些命令，可以帮助我们快速的定位问题。例如前面的示例输出，多个证据证明有JAVA进程占用了大量CPU资源，之后的性能调优就可以针对应用程序进行。

 

还没实践过，但感觉很高级的样子

转自： <span style="color:#005fd2; ">http</span>:<span style="color:#808030; ">/</span><span style="color:#808030; ">/</span>www<span style="color:#808030; ">.</span>infoq<span style="color:#808030; ">.</span>com<span style="color:#808030; ">/</span>cn<span style="color:#808030; ">/</span>news<span style="color:#808030; ">/</span><span style="color:#008c00; ">2015</span><span style="color:#808030; ">/</span><span style="color:#008c00; ">12</span><span style="color:#808030; ">/</span>linux<span style="color:#808030; ">-</span>performance
                                </pre></div>
                                <div class="comment-icons">
                                        <ul>
                                                <li><span></span><a href="#">Golang</a> </li>
                                                <li><span class="clndr"></span>FEBRUARY 24, 2016</li>
                                                <li><span class="admin"></span> <a href="#">Zhentianzhen</a></li>
                                        </ul>
                                </div>
                        </div>	
                </div>	
                <div class="col-md-4 single-page-right">
                        <div class="category">
                                <h4>Categories</h4>
                                <div class="list-group">
                                        <a href="singlepage.html" class="list-group-item">Cras justo odio</a>
                                        <a href="singlepage.html" class="list-group-item">Dapibus ac facilisis in</a>
                                        <a href="singlepage.html" class="list-group-item">Morbi leo risus</a>
                                        <a href="singlepage.html" class="list-group-item">Porta ac consectetur ac</a>
                                        <a href="singlepage.html" class="list-group-item">Vestibulum at eros</a>
                                        <a href="singlepage.html" class="list-group-item">Cras justo odio</a>
                                        <a href="singlepage.html" class="list-group-item">Cras justo odio</a>
                                        <a href="singlepage.html" class="list-group-item">Cras justo odio</a>
                                </div>
                        </div>	
                </div>
                <div class="clearfix"> </div>
        </div>	
</div>
<!--//single-page-->
<!--footer-->
<div class="copy-right">
        <div class="container">
                <p>Copyright &copy; 2016.Zhentianzhen All rights reserved.</p>
        </div>
</div>
<!--//footer-->
<!--smooth-scrolling-of-move-up-->
<script type="text/javascript">
$(document).ready(function() {
                /*
                   var defaults = {
containerID: 'toTop', // fading element id
containerHoverID: 'toTopHover', // fading element hover id
scrollSpeed: 1200,
easingType: 'linear' 
};
                 */

                $().UItoTop({ easingType: 'easeOutQuart' });

                });
</script>
<a href="#" id="toTop" style="display: block;"> <span id="toTopHover" style="opacity: 1;"> </span></a>
<!--//smooth-scrolling-of-move-up-->
<!-- Bootstrap core JavaScript
    ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="../javascripts/bootstrap.js"></script>
</body>
</html>
